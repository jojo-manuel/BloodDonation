services:
  # ==========================================
  # BACKEND API SERVICE (Port 5000)
  # ==========================================
  blood-backend-api:
    build:
      context: ../
      dockerfile: blood-system/backend-monolith/Dockerfile
    container_name: blood-backend-api
    ports:
      - "5000:3000" # Host Port 5000 -> Container Port 3000 (API)
    environment:
      - PORT=3000
      - MONGODB_URI=mongodb://blood-db:27017/blood-monolith
      - JWT_SECRET=${JWT_SECRET:-your-secret-key-change-in-production}
      - JWT_EXPIRES_IN=24h
      - SMTP_HOST=${SMTP_HOST:-smtp.gmail.com}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USER=${SMTP_USER:-}
      - SMTP_PASS=${SMTP_PASS:-}
    depends_on:
      - blood-db
    networks:
      - app-net

  # ==========================================
  # FRONTEND SERVICES (Separated by Role)
  # ==========================================

  # Login / Main App Container (Port 3000)
  web-login:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    container_name: blood-frontend-login
    ports:
      - "3000:80"
    volumes:
      - ../frontend/nginx-local.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - blood-backend-api
    networks:
      - app-net

  # Admin Dashboard Container (Port 3001)
  web-admin:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    container_name: blood-frontend-admin
    ports:
      - "3001:80"
    volumes:
      - ../frontend/nginx-local.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - blood-backend-api
    networks:
      - app-net

  # Donor Dashboard Container (Port 3002)
  web-donor:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    container_name: blood-frontend-donor
    ports:
      - "3002:80"
    volumes:
      - ../frontend/nginx-local.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - blood-backend-api
    networks:
      - app-net

  # Blood Bank Dashboard Container (Port 3003)
  web-bloodbank:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    container_name: blood-frontend-bloodbank
    ports:
      - "3003:80"
    volumes:
      - ../frontend/nginx-local.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - blood-backend-api
    networks:
      - app-net

  # ==========================================
  # DATABASE
  # ==========================================
  blood-db:
    image: mongo:6
    container_name: blood-db
    volumes:
      - blood-data:/data/db
    networks:
      - app-net

networks:
  app-net:
    driver: bridge

volumes:
  blood-data:
