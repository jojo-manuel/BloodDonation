services:
  # ==========================================
  # FRONTEND SERVICES (Publicly Accessible)
  # ==========================================
  frontend:
    build: ../frontend
    container_name: blood-frontend
    ports:
      - "5173:80"
    depends_on:
      - backend
    networks:
      - frontend-net

  admin-frontend:
    build:
      context: ../frontend
    container_name: blood-admin-frontend
    ports:
      - "5174:80"
    volumes:
      - ../frontend/nginx-admin.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend
    networks:
      - frontend-net

  sys-admin-frontend:
    build:
      context: ../frontend
    container_name: blood-sys-admin-frontend
    ports:
      - "5175:80"
    volumes:
      - ../frontend/nginx-sysadmin.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend
    networks:
      - frontend-net

  # ==========================================
  # BACKEND MONOLITH SERVICE
  # ==========================================
  backend:
    build:
      context: ./backend-monolith
    container_name: blood-backend
    ports:
      - "3000:3000" # Expose Gateway port (Monolith acts as Gateway now)
    environment:
      - PORT=3000
      - MONGODB_URI=mongodb://blood-db:27017/blood-monolith
      - JWT_SECRET=${JWT_SECRET:-your-secret-key-change-in-production}
      - JWT_EXPIRES_IN=24h
      - SMTP_HOST=${SMTP_HOST:-smtp.gmail.com}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USER=${SMTP_USER:-}
      - SMTP_PASS=${SMTP_PASS:-}
    depends_on:
      - blood-db
    networks:
      - frontend-net
      - backend-net

  blood-db:
    image: mongo:6
    container_name: blood-db
    volumes:
      - blood-data:/data/db
    networks:
      - backend-net
  # ==========================================
  # OPTIONAL SERVICES (IoT, Ledger - kept separate for now or remove?)
  # Keeping them disabled/commented as they were optional profiles
  # ==========================================


  # ==========================================
  # NETWORKS
  # ==========================================
networks:
  frontend-net:
    driver: bridge
  backend-net:
    driver: bridge

volumes:
  blood-data:
